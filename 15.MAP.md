## MAP

eBPF에서는 다양한 유형의 맵(Map)을 처리할 수 있습니다. 각각의 맵은 특정한 용도에 맞게 설계되어 있고, 다양한 상황에서 사용됩니다. 아래는 일반적으로 사용되는 몇 가지 맵의 유형입니다:

### 1. Hash Map:

* 해시 맵은 키-값 쌍을 저장하고 검색하는 데 사용됩니다.
* 빠른 조회 속도를 제공하며, 키에 대한 해시 함수를 사용하여 맵 내의 요소를 분산합니다.
* 충돌을 처리하기 위해 체인 형태로 해결됩니다.

### 2. Array Map:

* 배열 맵은 인덱스를 키로 사용하여 값에 접근하는 데 사용됩니다.
* 인덱스는 0부터 시작하며, 배열의 크기는 고정되어 있습니다.
* 인덱스를 통해 빠르게 값을 검색할 수 있습니다.

### 3. Per-CPU Array/Hash Map:

* CPU 코어별로 분리된 맵입니다. 각 CPU 코어마다 맵이 별도로 있으므로 병렬 처리를 가능하게 합니다.
* 특히 멀티코어 시스템에서 성능을 향상시키는 데 유용합니다.

### 4. Stack:

* 스택은 후입선출(LIFO) 구조로 데이터를 저장하는 데 사용됩니다.
* 주로 간단한 데이터를 임시로 저장하거나 추적할 때 사용됩니다.


### 5. Queue:

* 큐는 선입선출(FIFO) 구조로 데이터를 저장하는 데 사용됩니다.
* 데이터가 입력된 순서대로 처리되어야 할 때 유용합니다.


### 6. Per-CPU Stack/Queue:

* CPU 코어별로 분리된 스택 또는 큐입니다. 각 CPU 코어마다 스택 또는 큐가 별도로 있으므로 병렬 처리를 가능하게 합니다.
* 데이터를 병렬로 처리하거나 분산 저장할 때 유용합니다.



## function


eBPF 프로그램 내에서 맵(Map)을 처리하는 함수에는 여러 가지가 있습니다. 이러한 함수들은 맵을 생성하고 초기화하는 데 사용되거나 맵에 데이터를 추가하거나 업데이트하고 조회하는 데 사용됩니다. 일반적으로 사용되는 eBPF 맵 처리 함수의 종류에는 다음과 같은 것들이 있습니다:

### 1. bpf_map_lookup_elem():

맵에서 지정된 키에 해당하는 값을 조회합니다.

/*
 * bpf_map_lookup_elem
 *
 * 	Perform a lookup in *map* for an entry associated to *key*.
 *
 * Returns
 * 	Map value associated to *key*, or **NULL** if no entry was
 * 	found.
 */

### 2. bpf_map_update_elem():

맵에 새로운 키-값 쌍을 추가하거나 이미 존재하는 키의 값을 업데이트합니다.

/*
 * bpf_map_update_elem
 *
 * 	Add or update the value of the entry associated to *key* in
 * 	*map* with *value*. *flags* is one of:
 *
 * 	**BPF_NOEXIST**
 * 		The entry for *key* must not exist in the map.
 * 	**BPF_EXIST**
 * 		The entry for *key* must already exist in the map.
 * 	**BPF_ANY**
 * 		No condition on the existence of the entry for *key*.
 *
 * 	Flag value **BPF_NOEXIST** cannot be used for maps of types
 * 	**BPF_MAP_TYPE_ARRAY** or **BPF_MAP_TYPE_PERCPU_ARRAY**  (all
 * 	elements always exist), the helper would return an error.
 *
 * Returns
 * 	0 on success, or a negative error in case of failure.
 */

### 3. bpf_map_delete_elem():

맵에서 지정된 키에 해당하는 값을 제거합니다.
/*
 * bpf_map_update_elem
 *
 * 	Add or update the value of the entry associated to *key* in
 * 	*map* with *value*. *flags* is one of:
 *
 * 	**BPF_NOEXIST**
 * 		The entry for *key* must not exist in the map.
 * 	**BPF_EXIST**
 * 		The entry for *key* must already exist in the map.
 * 	**BPF_ANY**
 * 		No condition on the existence of the entry for *key*.
 *
 * 	Flag value **BPF_NOEXIST** cannot be used for maps of types
 * 	**BPF_MAP_TYPE_ARRAY** or **BPF_MAP_TYPE_PERCPU_ARRAY**  (all
 * 	elements always exist), the helper would return an error.
 *
 * Returns
 * 	0 on success, or a negative error in case of failure.
 */

### 4. bpf_map_lookup_and_delete_elem():

맵에서 지정된 키에 해당하는 값을 조회하고 동시에 그 값을 제거합니다.

### 5. bpf_map_push_elem():

스택(Map Type: BPF_MAP_TYPE_STACK)에 값을 추가합니다.

### 6. bpf_map_pop_elem():

스택(Map Type: BPF_MAP_TYPE_STACK)에서 값을 제거하고 반환합니다.

### 7. bpf_map_peek_elem():

스택(Map Type: BPF_MAP_TYPE_STACK)에서 값을 조회하지만 제거하지 않습니다.

### 8. bpf_map_inc():

맵에서 지정된 키에 해당하는 값을 증가시킵니다. (원자적 증가 연산)

### 9. bpf_map_inc_and_return():

맵에서 지정된 키에 해당하는 값을 증가시킨 후 그 값을 반환합니다.

### 10. bpf_map_delete_batch():

여러 개의 맵 항목을 한 번에 제거합니다. (범위 삭제)

### 11. bpf_map_lookup_batch():

여러 개의 맵 항목을 한 번에 조회합니다. (범위 조회)

### 12. bpf_map_update_batch():

여러 개의 맵 항목을 한 번에 추가하거나 업데이트합니다. (범위 추가 또는 업데이트)



