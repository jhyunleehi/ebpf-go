## perf

perf는 리눅스 시스템에서의 성능 분석과 프로파일링을 위한 강력한 도구입니다. 이를 사용하면 CPU 사용량, 메모리 액세스, 함수 호출 및 여러 다른 이벤트를 추적하여 시스템의 동작을 분석할 수 있습니다.

### 주요 기능과 사용 사례는 다음과 같습니다:

1. 이벤트 추적: perf를 사용하여 CPU 이벤트 (예: 명령어 수행, 캐시 미스 등), 메모리 이벤트 (예: 페이지 폴트), 하드웨어 이벤트 (예: 인터럽트) 등을 추적할 수 있습니다.

2. 프로파일링: 프로그램이나 프로세스의 실행 시간을 추적하여 코드에서 가장 시간이 많이 소비되는 부분을 식별할 수 있습니다.

3. 히트맵 출력: perf는 히트맵 형태의 출력을 생성하여 코드에서의 성능 병목 현상을 시각적으로 파악할 수 있도록 도와줍니다.

4. 사용자 공간 및 커널 공간에서의 분석: perf는 사용자 공간에서 실행되는 프로그램 뿐만 아니라 커널 내부에서도 이벤트를 추적할 수 있습니다.

4. 동적 추적: 프로그램 실행 중에 perf를 사용하여 동적으로 이벤트를 추적할 수 있습니다.

perf는 다양한 옵션과 서브 명령을 제공하여 사용자가 다양한 성능 분석 시나리오를 처리할 수 있도록 합니다. 이는 시스템 최적화, 프로그램 프로파일링, 성능 테스팅 및 디버깅 등에 유용합니다.


### perf command

#### 1. CPU 이벤트 추적:
CPU의 instruction retired 이벤트를 추적하여 프로그램의 명령어 실행 수를 확인할 수 있습니다.

```
$ perf stat -e instructions <command>
```
#### 2. 프로파일링:
프로그램 실행 시간을 추적하여 코드에서 시간이 가장 많이 소비되는 함수를 확인할 수 있습니다.

```
$ perf record -e cpu-clock -g -- <command>
$ perf report
```

### 3. 히트맵 출력:
프로그램 실행 중에 perf를 사용하여 동적으로 히트맵을 출력합니다.

```
$ perf record -e cycles:pp -ag -- sleep 10
$ perf report --stdio --sort comm,dso,symbol --tui
```

### 4. 커널 이벤트 추적:
커널 함수 호출을 추적하여 커널 내부 동작을 분석할 수 있습니다.

```
$ perf record -e probe:vfs_read -ag -- sleep 10
$ perf report
```

### 5. 사용자 정의 이벤트 추적:
사용자 정의 이벤트를 추적하여 특정 조건에서 발생하는 이벤트를 분석할 수 있습니다.

```
$ perf record -e <event_name> <command>
$ perf report
```
위 예시들은 perf를 사용하여 다양한 성능 분석 작업을 수행하는 방법을 보여줍니다. 실제로는 다양한 옵션과 서브 명령을 통해 더 많은 세부 정보를 추출하고 다양한 시나리오에 적용할 수 있습니다.


